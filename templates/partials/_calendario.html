{% load static %}

<!-- Calendário e lista de clientes agendados por data -->
<section>
    <div class="container-lg">
        <div class="container-fluid d-md-flex justify-content-between">
            <aside class="flex-fill">
                <div id="calendar"></div>
            </aside>
            <!-- Lista de clientes agendados -->
            <aside class="flex-fill ms-2" id="acord">
                <form action=" {% url 'index' %} ">
                <div class="input-group">
                    <input class="form-control" type="text" placeholder="Digite o nome da(o) cliente..." name="pesquisa_agendamentos">
                    <button class="btn btn-danger" type="submit">Pesquisar</button>
                </div>
                <div class="accordion" id="accordionUI">
                    {% if dados %}
                        {% for evento in dados %}
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingAcor{{cliente.id}}">
                                <button class="accordion-button bg-danger text-light fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAcor{{ evento.id}}" aria-expanded="true" aria-controls="collapseAcor{{ evento.id}}">
                                    {{ evento.cliente|upper }}
                                </button>
                            </h2>
                            <div id="collapseAcor{{evento.id}}" class="accordion-collapse collapse" aria-labelledby="headingAcor{{evento.id}}" data-bs-parent="#accordionUI">
                                <table class="table">
                                    <tr>
                                        <td rowspan="3" class="w-50">
                                            {% if evento.cliente.foto == '' %}
                                                <img class="img-fluid rounded img-thumbnail" src="{% static 'img/perfil.png' %}" alt="Fotografia">
                                            {% else %}
                                                <img class="img-fluid rounded img-thumbnail" src="{{ evento.cliente.foto.url }}" alt="Fotografia">
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle"><i class="fas fa-calendar-day text-danger"></i> <b>{{ evento.start|date:"d/m/Y" }}</b></td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle"><i class="far fa-clock text-danger"></i> <b>{{evento.hora}}hs</b></td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle"><i class="fas fa-map-marker-alt text-danger"></i> <b>{{evento.local_atendimento}}</b></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" class="align-middle"><i class="fas fa-procedures text-danger"></i> <b>{{evento.procedimento}}</b></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" class="align-middle text-muted"><i class="fas fa-comment-alt text-danger"></i> <b>{{evento.obs_agenda}}</b></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div>
                            <p class="alert alert-danger">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
                                    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                                </svg>
                                Nenhuma agendamento encontrado.
                            </p>
                        </div>
                    {% endif %}
                </div>
                </form>
                {% include 'partials/_paginacao.html' %}
            </aside>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            var calendarUI = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarUI,{
                /* themeSystem: 'bootstrap', //Define o tema para usar o padrão do Bootstrap*/
                initialView: 'dayGridMonth',
                selectable: 'true',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    end: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
                },
                navLinks: true,
                dayMaxEvents: true,
                locale: 'pt-BR',
                timeZone: 'America/Sao_Paulo',
                eventTimeFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                },
                //editable: true, //Permite que os agendamentos sejam movimentados dentro do grid
                events:[
                    {% if agendamentos %}
                        {% for evento in agendamentos %}
                            {
                                title: '{{ evento.cliente }}',
                                start: '{{ evento.start|date:"Y-m-d" }} {{ evento.hora }}',
                                color: '{{ evento.cor }}'
                            },
                        {% endfor %}
                    
                    {% endif %}
                ]
            });
            calendar.render();
        });
    </script>
</section>